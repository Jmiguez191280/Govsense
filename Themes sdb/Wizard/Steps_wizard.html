<style>
    #wizard-body {
        background: linear-gradient(to bottom, #333, #f1f1f1) !important;
        color: #000;
        position: relative;
        height: 100%;
        min-height: 500px;
        padding: 150px 0;
    }
    
    .nav-pills>li.active>a,
    .nav-pills>li.active>a:hover,
    .nav-pills>li.active>a:focus {
        color: #fff;
        background-color: #337ab7;
    }
    
    .progress-bar.progress-bar-success {
        background-color: #337ab7 !important;
    }
    
    #wizard-body a.next {
        background: red;
        border: none;
        border-radius: 0px;
        padding: 10px 20px 10px 20px;
        margin-top: 20px;
        color: #fff;
    }
    
    #wizard-body a.next:hover {
        background: transparent;
        border: 1px solid red;
        cursor: pointer;
    }
    
    #wizard-body a.prev {
        background: gray;
        border: none;
        border-radius: 0px;
        padding: 10px 20px;
        margin: 20px 20px 0 0;
        color: #fff;
    }
    
    #wizard-body a.prev:hover {
        background: transparent;
        border: 1px solid gray;
        cursor: pointer;
    }
    
    #wizard-body .well {
        background: #929292;
        border-radius: 0;
        border: none;
        color: #000;
    }
    
    #wizard-body .well label {
        color: #fff;
    }
    
    #wizard-body .well #radiosBtns {
        background: #fff;
        padding: 20px;
    }
    
    #wizard-body #step2 #radiosBtns label {
        color: #000;
        margin-left: 6px;
    }
    
    #wizard-body .container {
        padding: 0 19%;
    }
    
    #wizard-body .nav {
        background: #d2d2d2;
    }
    
    #wizard-body .nav.nav-pills>li>a {
        border-radius: 0;
    }
</style>
<script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
<div id="wizard-body">
    <div class="container" id="myWizard">

        <script>
            function prevStep() {
                jQuery('[href=#' + 'step1' + ']').tab('show');
            }

            function prevStep3() {
                jQuery('[href=#' + 'step2' + ']').tab('show');
            }
        </script>
        <div class="progress">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="2" style="width: 50%;">
                Step 1 of 2
            </div>
        </div>

        <div class="navbar">
            <div class="navbar-inner">
                <ul class="nav nav-pills">
                    <li id="stp_1" class="active"><a href="#step1" data-toggle="tab" data-step="1">Step 1</a></li>
                    <li><a id="stp_2" href="#step2" data-toggle="tab" data-step="2">Step 2</a></li>
                    <!-- <li><a id="stp_3" href="#step3" data-toggle="tab" data-step="3">Step 3</a></li> -->

                </ul>
            </div>
        </div>
        <div class="tab-content">
            <div class="tab-pane fade in active" id="step1">

                <div class="well">

                    <label>Business Tax Receipt Renewal ID</label>
                    <input id="invid" class="form-control">

                </div>

                <a class="next" href="#">Continue ></a>
            </div>
            <div class="tab-pane fade" id="step2">
                <div class="well">

                    <div id="results"></div>

                </div>
                <a id="prev1" class="prev">
                    < Previous </a>
                        <a id="btnSubmit" onclick="submit();" class="next"> Submit </a>
            </div>
            <!-- <div class="tab-pane fade" id="step3">
                <div class="well">        
                </div>
                <a  id="prev3" class="prev"> < Previous </a>
            </div> -->
        </div>
    </div>
</div>
<script>
    var invIdGlobal = '';
    var ipAddress = '';
    $.getJSON('https://api.ipify.org?format=json', function(data) {
        ipAddress = data.ip
        console.log('ip --', data.ip);
    });

    function redirect() {
        var invId = jQuery("#invoice").text().trim()
        var customer = jQuery("#customerId").text().trim()
        var optionVal = jQuery('input:radio[name=gender]:checked').val();
        if (optionVal == 'ok') {
            window.location.href = 'https://checkout.paystand.com/v4/?publishableKey=gn7vb9t26qwlp96wgcbc00uj&viewCheckout=portal-medium&module=ns_openInvoices&extCustomerId=' + customer + '&externalCss=https:%2F%2Fwww.paystand.com%2Fhubfs%2Fcustom_css%2Fcityofocala%2Focala.css&logoUrl=https:%2F%2Fwww.paystand.com%2Fhubfs%2Fcustom_css%2Fcityofocala%2FOcala_Logo_150px.png&drawerType=open_displaced_toggle'
        } else if (optionVal == 'noOk') {
            $('[href=#' + 'step1' + ']').tab('show');
        } else if (optionVal == 'contact') {
            window.location.href = 'https://growthmanagement.ocalafl.org/contact-us.html';
        }
    }

    function submit() {
        debugger;

        if (jQuery('#licInfo')[0]) {
            var renewalId = jQuery('#invoice').text();
            var busName = jQuery('#BusinessName').text();
            var busLicense = jQuery('#name').text();
            var option = jQuery('input:radio[name=gender]:checked').next().text();

            var jsonData = {
                renewalId: renewalId,
                busName: busName,
                busLicense: busLicense,
                option: option,
                ipAddress: ipAddress
            };

            redirect();
        } else {
            var jsonData = {
                renewalId: invIdGlobal,
                busName: '',
                busLicense: '',
                option: '',
                ipAddress: ipAddress
            };
        }
        jQuery.ajax({
                method: "GET",
                url: "/app/site/hosting/scriptlet.nl?script=244&deploy=1&compid=4778042&h=226ca2f1d50cc6c58f0d&jsonData=" + escape(JSON.stringify(jsonData)),
                cache: false,
                async: true

            })
            .done(function(msg) {
                console.log(msg)
                debugger;

            })
    }

    $(document).ready(function() {

        $('.next').click(function() {
            debugger;
            invIdGlobal = jQuery('#invid').val();
            var nextId = $(this).parents('.tab-pane').next().attr("id");
            $('[href=#' + nextId + ']').tab('show');
            return false;
        })
        $('.prev').click(function() {
            debugger;
            var nextId = $(this).parents('.tab-pane').attr("id");
            if (nextId.indexOf('2') != -1) $('[href=#' + 'step1' + ']').tab('show');
            if (nextId.indexOf('3') != -1) $('[href=#' + 'step2' + ']').tab('show');

            return false;
        })
        $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
            //update progress
            debugger;
            var step = $(e.target).data('step');

            if (parseInt(step) == 2) serachLicense(e)

            var percent = (parseInt(step) / 2) * 100;
            $('.progress-bar').css({
                width: percent + '%'
            });
            $('.progress-bar').text("Step " + step + " of 2");
            //e.relatedTarget // previous tab
        })

        function serachLicense(e) {
            var invoiceID = jQuery('#invid').val().trim();
            jQuery("#results").html('');
            e.preventDefault();
            if (invoiceID) {

                jQuery.ajax({
                        method: "GET",
                        url: "/app/site/hosting/scriptlet.nl?script=243&deploy=1&compid=4778042&h=d58a55c5f38e1a06f31d&invId=" + invoiceID,
                        dataType: "json",
                        cache: false,
                        async: true
                    })
                    .done(function(msg) {
                        if (msg.invoice) {
                            debugger;
                            var resultsStr = '<p style="display:none" id="customerId">' + msg.customerId + '</p>';
                            resultsStr += '<div id="licInfo"><p>Business Name : </p><span id="BusinessName">' + msg.name + '</span>';
                            resultsStr += '<p >Business License :</p><span id="name"> ' + msg.license + '</span>';
                            resultsStr += '<p id="location">Location :</p><span id="location">  ' + msg.location + '</span>';
                            resultsStr += '<p >Renewal ID : </p><span id="invoice"> ' + msg.invoice + ' </span></div><br>';
                            resultsStr += '<div id="radiosBtns"><p>Please select one of the following options :</p>'
                            resultsStr += '<input  type="radio" id="yesOk" name="gender"  value="ok">'
                            resultsStr += '<label id="label1" for="yesOk" style="float:none;">Yes,this is my business.</label><br>'
                            resultsStr += '<input  type="radio" id="noOk" name="gender"  value="noOk">'
                            resultsStr += '<label for="noOk" style="float:none;">No,this is not my business. i would like to try again.</label><br>'
                            resultsStr += '<input  type="radio" id="contact" name="gender"  value="contact">'
                            resultsStr += '<label for="contact" style="float:none;">I would like to contact Growth Management Department</label></div>'
                            jQuery("#results").html(resultsStr);
                            // renderResult(msg)
                        } else {
                            jQuery("#results").html('<p>There are no results for this Renewal ID. Try again.</p>');
                        }
                    })
            }
        }

        $('.first').click(function() {
            debugger;
            $('#myWizard a:first').tab('show')

        })

    });
</script>